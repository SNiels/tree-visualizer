!function(t){function e(e){t(e.containerSS).append('<div id="tv-error" style="display: none"><p></p></div>'),h=t("#tv-error");var n=[],i=[];if(e.normalView){C=!0,t(e.containerSS).append('<div id="tree-visualizer" style="display: none"></div>'),c=t("#tree-visualizer");var o='<div class="tree"></div><aside class="tooltip" style="display: none"><ul></ul><button>&#10005;</button></aside>';e.fsView&&(o+='<button class="show-tv">Fullscreen</button>'),c.append(o),m=c.find(".tree"),g=c.find(".tooltip"),n.push("#tree-visualizer .tree"),i.push("#tree-visualizer .tooltip")}if(e.fsView){x=!0,t("body").append('<div id="fs-tree-visualizer" style="display: none"></div>'),f=t("#fs-tree-visualizer");var a='<div class="tree size0"></div><aside class="tooltip" style="display: none"><ul></ul><button>&#10005;</button></aside><div class="zoom-opts"><button class="zoom-out">-</button><button class="zoom-default">Default</button><button class="zoom-in">+</button><button class="close">&#10005;</button></div>';f.hide().append(a),v=f.find(".tree"),b=f.find(".tooltip"),z=f.find(".zoom-opts"),n.push("#fs-tree-visualizer .tree"),i.push("#fs-tree-visualizer .tooltip")}V=e.advanced,""!=e.fsBtn&&t(e.fsBtn).addClass("show-tv"),w=t(n.join()),y=t(i.join())}function n(e){t.ajax({type:"GET",url:e,dataType:"xml"}).done(function(t){null==t?u("Your XML appears to be empty."):i(t)}).fail(function(t,e,n){u(e+": "+n)})}function i(e){var n=t(e);p(),w.html(o(n.find("node").first())),y.children("ul").empty(),a()}function o(e){var n=t("<ol/>");return e.each(function(e,i){for(var a=t('<li><a href="#">&nbsp;</a></li>'),s=0,d=i.attributes.length,l=null;d>s;s++)l=i.attributes[s],a.attr("data-"+l.nodeName,l.value.replace(/^\s(.+)/g,"$1")),("cat"==l.nodeName||"word"==l.nodeName)&&a.html('<a href="#">'+l.value+"</a>");t(this).children("node").length&&a.append(o(t(this).children("node"))),n.append(a)}),n}function a(){w.find("a:only-child").each(function(){var e=t(this),n=e.parent("li");0===e.next().length&&"&nbsp;"===e.html()?n.data("rel")&&e.html("<em>"+n.data("rel")+"</em>"):n.data("rel")&&n.append("<span><em>"+n.data("rel")+"</em></span>"),n.data("pt")&&n.append("<span>"+n.data("pt")+"</span>"),n.data("lemma")&&n.append("<span>"+n.data("lemma")+"</span>"),e.addClass("only-child")}),w.find("li:only-child").addClass("only-child"),w.find("li:first-child").addClass("first-child"),w.find("li:last-child").addClass("last-child"),C&&c.show()}function s(){I>2?z.find("button.zoom-in").prop("disabled",!0):-3>I?z.find("button.zoom-out").prop("disabled",!0):z.find("button").prop("disabled",!1)}function d(){v.attr("class",v.attr("class").replace(/(size)-?\d/,"$1"+I))}function l(){var e;"undefined"!=typeof v&&v.is(":visible")?e=v:"undefined"!=typeof m&&m.is(":visible")&&(e=m);var n=e.find("a.hovered");if(n.length){var i=e.next(".tooltip"),o=n.offset(),a=e.offset(),s=t(s),d={top:o.top,right:s.outerWidth()-(o.left+n.outerWidth()),bottom:s.outerHeight()-(o.top+n.outerHeight()),left:o.left,w:n.outerWidth(),h:n.outerHeight()},l={top:a.top,right:s.outerWidth()-(a.left+e.outerWidth()),bottom:s.outerHeight()-(a.top+e.outerHeight()),left:a.left,w:e.outerWidth(),h:e.outerHeight()};i.css({left:parseInt(d.left+d.w/2-i.outerWidth()/2+7.5,10),top:parseInt(d.top-i.outerHeight()-24,10)}),d.left+d.w/2<l.left||d.right+d.w/2<l.right||d.top-d.h/2<l.top||d.bottom+d.h<l.bottom?i.fadeOut("slow"):i.show()}}function r(){var e=parseInt(v.css("paddingRight"),10)||0,n=parseInt(v.css("paddingTop"),10)||0,i=parseInt(f.css("paddingRight"),10)||0,o=parseInt(f.css("paddingTop"),10)||0,a=v.children("ol"),s=t(window);v.css({width:a.outerWidth()+2*e,height:a.outerHeight()+2*n,"max-width":s.width()-2*i,"max-height":s.height()-2*o}),v.css({"margin-left":(s.width()-2*i-v.outerWidth())/2,"margin-top":(s.height()-2*o-v.outerHeight())/2})}function u(t){h.children("p").text(t).parent().fadeIn(250),C&&(m.scrollLeft(0),c.find(".show-tv").prop("disabled",!0))}function p(){h.hide(),C&&c.find(".show-tv").prop("disabled",!1)}var f,c,h,v,m,b,g,w,y,z,C,x,V,I=0;t.treeVisualizer=function(i,o){var a=t.extend({normalView:!0,fsView:!0,advanced:!1,fsBtn:"",containerSS:"body"},o);(a.normalView||a.fsView)&&t(a.containerSS).length?(e(a),n(i),t(".show-tv").click(function(t){y.css("top","-100%").children("ul").empty(),I=0,s(),d(),f.fadeIn(250),r(),t.preventDefault()}),w.scroll(function(){l()}),t(window).scroll(function(){l()}),x&&z.find("button").click(function(){var e=t(this);e.is(".close")?f.fadeOut(250,function(){v.find("a").removeClass("hovered")}):(e.is(".zoom-in")?I++:e.is(".zoom-out")?I--:e.is(".zoom-default")&&(I=0),s(),d(),r(),l())}),w.on("click","a",function(e){var n=t(this),i=n.parent("li"),o=i.data(),a=n.closest(".tree"),s=a.find("a"),d=a.next(".tooltip").children("ul");d.empty(),s.removeClass("hovered"),n.addClass("hovered");var r;for(r in o)o.hasOwnProperty(r)&&t("<li>",{html:"<strong>"+r+"</strong>: "+o[r]}).prependTo(d);l(),e.preventDefault()}),y.find("button").click(function(){var e=t(this),n=e.parent(".tooltip"),i=n.prev(".tree"),o=i.find("a");n.fadeOut(250),o.removeClass("hovered")}),window.onresize=r):console.error("Cannot initialize Tree Visualizer: either the container does not exist, or you have set both normal and fullscreen view to false, which does not make sense.")}}(jQuery);
