!function(t){t.fn.treeVisualizer=function(e,n){function i(){var e=[],n=[];if(S.normalView){I.append('<div class="tree-visualizer" style="display: none"></div>'),v=I.find(".tree-visualizer");var i='<div class="tv-error" style="display: none"><p></p></div><div class="tree" style="font-size: '+S.nvFontSize+'px;"></div><aside class="tooltip" style="display: none"><ul></ul><button>&#10005;</button></aside>';S.fsView&&(i+='<button class="tv-show-fs">Fullscreen</button>'),v.append(i),w=v.find(".tree"),z=v.find(".tooltip"),e.push(I.find(".tree-visualizer .tree")),n.push(I.find(".tree-visualizer .tooltip"))}if(S.fsView){I.append('<div class="tree-visualizer-fs" style="display: none"></div>'),h=I.find(".tree-visualizer-fs");var o="";S.normalView||(i+='<div class="tv-error" style="display: none"><p></p></div>'),o+='<div class="tree" style="font-size: '+S.fsFontSize+'px;"></div><aside class="tooltip" style="display: none"><ul></ul><button>&#10005;</button></aside><div class="zoom-opts"><button class="zoom-out">-</button><button class="zoom-default">Default</button><button class="zoom-in">+</button><button class="close">&#10005;</button></div>',h.append(o),m=h.find(".tree"),g=h.find(".tooltip"),C=h.find(".zoom-opts"),""!=S.sentence&&m.before('<div class="sentence">'+decodeURI(S.sentence)+"</div>"),e.push(I.find(".tree-visualizer-fs .tree")),n.push(I.find(".tree-visualizer-fs .tooltip"))}""!=S.fsBtn&&t(S.fsBtn).addClass("tv-show-fs"),b=t(e.join()),y=t(n.join())}function o(e){t.ajax({type:"GET",url:e,dataType:"xml"}).done(function(t){null==t?c("Your XML appears to be empty or not in a compatible format."):(a(t),S.initFSOnClick&&(h.fadeIn(250),r(),f()))}).fail(function(t){var e="";e=0===t.status?"Not connect.\n Verify Network.":404==t.status?"Requested page not found. [404]":500==t.status?"Internal Server Error [500].":"parsererror"===exception?"Requested parse failed.":"timeout"===exception?"Time out error.":"abort"===exception?"Ajax request aborted.":"Uncaught Error.\n"+t.responseText,c(e)})}function a(e){var n=t(e);u(),b.html(s(n.find("node").first())),y.children("ul").empty(),d()}function s(e){var n=t("<ol/>");return e.each(function(e,i){for(var o=t('<li><a href="#"></a></li>'),a=0,d=i.attributes.length,l=null;d>a;a++)l=i.attributes[a],"highlight"==l.nodeName?o.addClass("highlight"):"begin"!=l.nodeName&&"end"!=l.nodeName&&o.attr("data-"+l.nodeName,l.value.replace(/^\s(.+)/g,"$1"));t(this).children("node").length&&o.append(s(t(this).children("node"))),n.append(o)}),n}function d(){b.find("a").each(function(){var e=t(this),n=e.parent("li");n.data("rel")&&(e.append("<span>"+n.data("rel")+"<span>"),n.data("index")&&e.append("<span>"+n.data("index")+"</span>")),n.data("postag")&&S.extendedPOS?e.append("<span>"+n.data("postag")+"</span>"):n.data("pt")?n.data("index")?e.children("span:last-child").append(":"+n.data("pt")):e.append("<span>"+n.data("pt")+"</span>"):n.data("cat")&&(n.data("index")?e.children("span:last-child").append(":"+n.data("cat")):e.append("<span>"+n.data("cat")+"</span>")),e.is(":only-child")&&(n.data("lemma")&&n.append("<span>"+n.data("lemma")+"</span>"),n.data("word")&&n.append("<span><em>"+n.data("word")+"</em></span>"),e.addClass("only-child"))}),b.find("li:only-child").addClass("only-child"),b.find("li:first-child").addClass("first-child"),b.find("li:last-child").addClass("last-child"),S.normalView&&v.show()}function l(){var t=parseInt(m.css("fontSize"),10);4>=t?C.find("button.zoom-out").prop("disabled",!0):t>=32?C.find("button.zoom-in").prop("disabled",!0):(C.find("button").prop("disabled",!1),m.removeClass("small x-small")),8>=t&&(m.addClass("small"),4>=t&&m.addClass("x-small"))}function r(t){if("zoom-default"==t)m.css("fontSize",fsFontSize+"px");else{var e=parseInt(m.css("fontSize"),10);"zoom-in"==t?m.css("fontSize",e+2+"px"):"zoom-out"==t&&m.css("fontSize",e-2+"px")}l()}function p(t){var e;if("undefined"!=typeof m&&m.is(":visible")?e=m:"undefined"!=typeof w&&w.is(":visible")&&(e=w),"undefined"!=e){var n=e.find("a.hovered");if(n.length){var i=e.next(".tooltip"),o=n[0].getBoundingClientRect(),a=e[0].getBoundingClientRect(),s={top:o.top,right:o.left+a.width,bottom:o.top+a.height,left:o.left,w:o.width,h:o.height},d={top:a.top,right:a.left+a.width,bottom:a.top+a.height,left:a.left,w:a.width,h:a.height};t?i.animate({left:parseInt(s.left+s.w/2-i.outerWidth()/2+7.5,10),top:parseInt(s.top-i.outerHeight()-24,10)},250):i.css({left:parseInt(s.left+s.w/2-i.outerWidth()/2+7.5,10),top:parseInt(s.top-i.outerHeight()-24,10)}),s.left+s.w/2<d.left||s.right+s.w/2<d.right||s.top+s.h/2<d.top||s.bottom+s.h<d.bottom?i.fadeOut(400):i.fadeIn(250)}}}function f(){var t=parseInt(m.css("paddingRight"),10)||0,e=parseInt(m.css("paddingTop"),10)||0,n=parseInt(h.css("paddingRight"),10)||0,i=parseInt(h.css("paddingTop"),10)||0,o=m.children("ol"),a=m.prev(".sentence"),s=V;m.css({width:o[0].getBoundingClientRect().width+2*t,height:o[0].getBoundingClientRect().height+2*e,"max-width":s.width()-2*n,"max-height":s.height()-2*i-2*a[0].getBoundingClientRect().height}),a.css("max-width",m[0].getBoundingClientRect().width)}function c(t){errorContainer.children("p").text(t).parent().fadeIn(250),S.normalView&&(w.scrollLeft(0),v.find(".tv-show-fs").prop("disabled",!0))}function u(){errorContainer.hide(),S.normalView&&v.find(".tv-show-fs").prop("disabled",!1)}var h,v,m,w,g,z,b,y,C,x={normalView:!0,nvFontSize:12,fsView:!0,fsFontSize:14,fsBtn:"",sentence:"",initFSOnClick:!1,extendedPOS:!1},S=t.extend({},x,n),I=this,V=t(window);S.normalView||S.fsView?(i(),o(e)):console.error("Cannot initialize Tree Visualizer: either the container does not exist, or you have set both normal and fullscreen view to false, which does not make sense."),t(document).ready(function(){initFSOnClick||I.find(".tv-show-fs").click(function(t){y.css("top","-100%").children("ul").empty(),"undefined"!=typeof w&&w.find("a").removeClass("hovered"),r(),h.fadeIn(250),f(),t.preventDefault()}),b.scroll(function(){p()}),V.scroll(function(){p()}),h.click(function(e){var n=t(e.target);n.closest(".tv-error, .tree, .tooltip, .zoom-opts, .sentence").length||(h.fadeOut(250,function(){m.find("a").removeClass("hovered")}),S.initFSOnClick&&history.replaceState("",document.title,window.location.pathname+window.location.search))}),C.find("button").click(function(){var e=t(this);if(e.is(".close"))h.fadeOut(250,function(){m.find("a").removeClass("hovered")}),initFSOnClick&&history.replaceState("",document.title,window.location.pathname+window.location.search);else{e.is(".zoom-in")?r("zoom-in"):e.is(".zoom-out")?r("zoom-out"):e.is(".zoom-default")&&r("zoom-default"),f();var n=m.find("a.hovered").css("transition-duration")||200;n=n.indexOf("ms")>-1?parseFloat(n):1e3*parseFloat(n),n+=50,setTimeout(function(){p(!0)},n)}}),fsView&&V.on("resize",f),b.on("click","a",function(e){var n=t(this),i=n.parent("li"),o=i.data(),a=n.closest(".tree"),s=a.find("a"),d=a.next(".tooltip").children("ul");d.empty(),s.removeClass("hovered"),n.addClass("hovered");var l;for(l in o)o.hasOwnProperty(l)&&t("<li>",{html:"<strong>"+l+"</strong>: "+o[l]}).prependTo(d);p(),e.preventDefault()}),b.on("mouseout","a.hovered",function(){t(this).closest(".tree").hasClass("small")&&t(this).on("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){p(!0)})}),y.find("button").click(function(){var e=t(this),n=e.parent(".tooltip"),i=n.prev(".tree"),o=i.find("a");n.fadeOut(250),o.removeClass("hovered")})})}}(jQuery);
