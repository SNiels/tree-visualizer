!function(t){function e(e){t(e.containerSS).append('<div id="tv-error" style="display: none"><p></p></div>'),c=t("#tv-error");var i=[],o=[];if(e.normalView){x=!0,t(e.containerSS).append('<div id="tree-visualizer" style="display: none"></div>'),f=t("#tree-visualizer");var n='<div class="tree"></div><aside class="tooltip" style="display: none"><ul></ul><button>&#10005;</button></aside>';e.fsView&&(n+='<button class="show-tv">Fullscreen</button>'),f.append(n),m=f.find(".tree"),w=f.find(".tooltip"),i.push("#tree-visualizer .tree"),o.push("#tree-visualizer .tooltip")}if(e.fsView){C=!0,t("body").append('<div id="fs-tree-visualizer" style="display: none"></div>'),h=t("#fs-tree-visualizer");var a='<div class="tree size0"></div><aside class="tooltip" style="display: none"><ul></ul><button>&#10005;</button></aside><div class="zoom-opts"><button class="zoom-out">-</button><button class="zoom-default">Default</button><button class="zoom-in">+</button><button class="close">&#10005;</button></div>';h.hide().append(a),v=h.find(".tree"),b=h.find(".tooltip"),z=h.find(".zoom-opts"),i.push("#fs-tree-visualizer .tree"),o.push("#fs-tree-visualizer .tooltip")}H=e.advanced,""!=e.fsBtn&&t(e.fsBtn).addClass("show-tv"),g=t(i.join()),y=t(o.join())}function i(e){t.ajax({type:"GET",url:e,dataType:"xml"}).done(function(t){null==t?p("Your XML appears to be empty."):o(t)}).fail(function(t,e,i){p(e+": "+i)})}function o(e){var i=t(e);u(),g.html(n(i.find("node").first())),y.children("ul").empty(),a()}function n(e){var i=t("<ol/>");return e.each(function(e,o){for(var a=t('<li><a href="#">&nbsp;</a></li>'),s=0,d=o.attributes.length,l=null;d>s;s++)l=o.attributes[s],a.attr("data-"+l.nodeName,l.value.replace(/^\s(.+)/g,"$1")),("cat"==l.nodeName||"word"==l.nodeName)&&a.html('<a href="#">'+l.value+"</a>");t(this).children("node").length&&a.append(n(t(this).children("node"))),i.append(a)}),i}function a(){g.find("a:only-child").each(function(){var e=t(this),i=e.parent("li");0===e.next().length&&"&nbsp;"===e.html()?i.data("rel")&&e.html("<em>"+i.data("rel")+"</em>"):i.data("rel")&&i.append("<span><em>"+i.data("rel")+"</em></span>"),i.data("pt")&&i.append("<span>"+i.data("pt")+"</span>"),i.data("lemma")&&i.append("<span>"+i.data("lemma")+"</span>"),e.addClass("only-child")}),g.find("li:only-child").addClass("only-child"),g.find("li:first-child").addClass("first-child"),g.find("li:last-child").addClass("last-child"),x&&f.show()}function s(){V>2?z.find("button.zoom-in").prop("disabled",!0):-3>V?z.find("button.zoom-out").prop("disabled",!0):z.find("button").prop("disabled",!1)}function d(){v.attr("class",v.attr("class").replace(/(size)-?\d/,"$1"+V))}function l(){var e;"undefined"!=typeof v&&v.is(":visible")?e=v:"undefined"!=typeof m&&m.is(":visible")&&(e=m);var i=e.find("a.hovered");if(i.length){var o=e.next(".tooltip"),n=i.offset(),a=e.offset(),s=t(s),d={top:n.top,right:s.outerWidth()-(n.left+i.outerWidth()),bottom:s.outerHeight()-(n.top+i.outerHeight()),left:n.left,w:i.outerWidth(),h:i.outerHeight()},l={top:a.top,right:s.outerWidth()-(a.left+e.outerWidth()),bottom:s.outerHeight()-(a.top+e.outerHeight()),left:a.left,w:e.outerWidth(),h:e.outerHeight()};o.css({left:parseInt(d.left+d.w/2-o.outerWidth()/2+7.5,10),top:parseInt(d.top-o.outerHeight()-24,10)}),d.left+d.w/2<l.left||d.right+d.w/2<l.right||d.top-d.h/2<l.top||d.bottom+d.h<l.bottom?o.fadeOut("slow"):o.show()}}function r(){var e=parseInt(v.css("paddingRight"),10)||0,i=parseInt(v.css("paddingTop"),10)||0,o=parseInt(h.css("paddingRight"),10)||0,n=parseInt(h.css("paddingTop"),10)||0,a=v.children("ol"),s=t(window);v.css({width:a.outerWidth()+2*e,height:a.outerHeight()+2*i,"max-width":s.width()-2*o,"max-height":s.height()-2*n}),v.css({"margin-left":(s.width()-2*o-v.outerWidth())/2,"margin-top":(s.height()-2*n-v.outerHeight())/2})}function p(t){c.children("p").text(t).parent().fadeIn(250),x&&(m.scrollLeft(0),f.find(".show-tv").prop("disabled",!0))}function u(){c.hide(),x&&f.find(".show-tv").prop("disabled",!1)}var h,f,c,v,m,b,w,g,y,z,x,C,H,V=0;t.treeVisualizer=function(o,n){var a=t.extend({normalView:!0,fsView:!0,advanced:!1,fsBtn:"",containerSS:"body"},n);(a.normalView||a.fsView)&&t(a.containerSS).length?(e(a),i(o),t(".show-tv").click(function(t){y.css("top","-100%").children("ul").empty(),V=0,s(),d(),h.fadeIn(250),r(),t.preventDefault()}),g.scroll(function(){l()}),t(window).scroll(function(){l()}),C&&(z.find("button").click(function(){var e=t(this);e.is(".close")?h.fadeOut(250,function(){v.find("a").removeClass("hovered")}):(e.is(".zoom-in")?V++:e.is(".zoom-out")?V--:e.is(".zoom-default")&&(V=0),s(),d(),r(),l())}),window.onresize=r),g.on("click","a",function(e){var i=t(this),o=i.parent("li"),n=o.data(),a=i.closest(".tree"),s=a.find("a"),d=a.next(".tooltip").children("ul");d.empty(),s.removeClass("hovered"),i.addClass("hovered");var r;for(r in n)n.hasOwnProperty(r)&&t("<li>",{html:"<strong>"+r+"</strong>: "+n[r]}).prependTo(d);l(),e.preventDefault()}),y.find("button").click(function(){var e=t(this),i=e.parent(".tooltip"),o=i.prev(".tree"),n=o.find("a");i.fadeOut(250),n.removeClass("hovered")})):console.error("Cannot initialize Tree Visualizer: either the container does not exist, or you have set both normal and fullscreen view to false, which does not make sense.")}}(jQuery);
