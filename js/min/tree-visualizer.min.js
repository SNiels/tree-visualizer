!function(t){function e(e){errorContainer=t(".tv-error"),fontSizes=e.fsFontSizes,S=e.initFSOnClick;var i=[],o=[];if(e.normalView){g=!0,V=e.nvFontSize,t(e.container).append('<div id="tree-visualizer" style="display: none"></div>'),c=t("#tree-visualizer");var n='<div class="tv-error" style="display: none"><p></p></div><div class="tree" style="font-size: '+V+'px;"></div><aside class="tooltip" style="display: none"><ul></ul><button>&#10005;</button></aside>';e.fsView&&(n+='<button class="tv-show-fs">Fullscreen</button>'),c.append(n),v=c.find(".tree"),w=c.find(".tooltip"),i.push("#tree-visualizer .tree"),o.push("#tree-visualizer .tooltip")}if(e.fsView){x=!0,C=e.fsFontSize,t("body").append('<div id="tree-visualizer-fs" style="display: none"></div>'),f=t("#tree-visualizer-fs");var a='<div class="tv-error" style="display: none"><p></p></div><div class="tree" style="font-size: '+C+'px;"></div><aside class="tooltip" style="display: none"><ul></ul><button>&#10005;</button></aside><div class="zoom-opts"><button class="zoom-out">-</button><button class="zoom-default">Default</button><button class="zoom-in">+</button><button class="close">&#10005;</button></div>';f.hide().append(a),h=f.find(".tree"),m=f.find(".tooltip"),y=f.find(".zoom-opts"),i.push("#tree-visualizer-fs .tree"),o.push("#tree-visualizer-fs .tooltip")}advanced=e.advanced,""!=e.fsBtn&&t(e.fsBtn).addClass("tv-show-fs"),z=t(i.join()),b=t(o.join())}function i(e){t.ajax({type:"GET",url:e,dataType:"xml"}).done(function(t){null==t?p("Your XML appears to be empty or not in a compatible format."):(o(t),S&&(f.fadeIn(250),r(),s(),l()))}).fail(function(t){var e="";e=0===t.status?"Not connect.\n Verify Network.":404==t.status?"Requested page not found. [404]":500==t.status?"Internal Server Error [500].":"parsererror"===exception?"Requested parse failed.":"timeout"===exception?"Time out error.":"abort"===exception?"Ajax request aborted.":"Uncaught Error.\n"+t.responseText,p(e)})}function o(e){var i=t(e);u(),z.html(n(i.find("node").first())),b.children("ul").empty(),a()}function n(e){var i=t("<ol/>");return e.each(function(e,o){for(var a=t('<li><a href="#"></a></li>'),r=0,s=o.attributes.length,d=null;s>r;r++)d=o.attributes[r],a.attr("data-"+d.nodeName,d.value.replace(/^\s(.+)/g,"$1"));t(this).children("node").length&&a.append(n(t(this).children("node"))),i.append(a)}),i}function a(){z.find("a").each(function(){var e=t(this),i=e.parent("li");i.data("rel")&&(e.append("<span>"+i.data("rel")+"<span>"),i.data("index")&&e.append("<span>"+i.data("index")+"</span>")),i.data("pt")?i.data("index")?e.children("span:last-child").append(":"+i.data("pt")):e.append("<span>"+i.data("pt")+"</span>"):i.data("cat")&&(i.data("index")?e.children("span:last-child").append(":"+i.data("cat")):e.append("<span>"+i.data("cat")+"</span>")),e.is(":only-child")&&(i.data("lemma")&&i.append("<span>"+i.data("lemma")+"</span>"),i.data("word")&&i.append("<span><em>"+i.data("word")+"</em></span>")),e.addClass("only-child")}),z.find("li:only-child").addClass("only-child"),z.find("li:first-child").addClass("first-child"),z.find("li:last-child").addClass("last-child"),g&&c.show()}function r(){var t=parseInt(h.css("fontSize"),10);2>=t?y.find("button.zoom-out").prop("disabled",!0):t>=32?y.find("button.zoom-in").prop("disabled",!0):y.find("button").prop("disabled",!1)}function s(t){if("zoom-default"==t)h.css("fontSize",C+"px");else{var e=parseInt(h.css("fontSize"),10);"zoom-in"==t?h.css("fontSize",e+2+"px"):"zoom-out"==t&&h.css("fontSize",e-2+"px")}}function d(){var e;if("undefined"!=typeof h&&h.is(":visible")?e=h:"undefined"!=typeof v&&v.is(":visible")&&(e=v),"undefined"!=e){var i=e.find("a.hovered");if(i.length){var o=e.next(".tooltip"),n=i.offset(),a=e.offset(),r=t(window),s={top:n.top,right:r.outerWidth()-(n.left+i.outerWidth()),bottom:r.outerHeight()-(n.top+i.outerHeight()),left:n.left,w:i.outerWidth(),h:i.outerHeight()},d={top:a.top,right:r.outerWidth()-(a.left+e.outerWidth()),bottom:r.outerHeight()-(a.top+e.outerHeight()),left:a.left,w:e.outerWidth(),h:e.outerHeight()};o.css({left:parseInt(s.left+s.w/2-o.outerWidth()/2+7.5,10),top:parseInt(s.top-o.outerHeight()-24,10)-r.scrollTop()}),s.left+s.w/2<d.left||s.right+s.w/2<d.right||s.top+s.h/2<d.top||s.bottom+s.h<d.bottom?o.fadeOut(400):o.show()}}}function l(){var e=parseInt(h.css("paddingRight"),10)||0,i=parseInt(h.css("paddingTop"),10)||0,o=parseInt(f.css("paddingRight"),10)||0,n=parseInt(f.css("paddingTop"),10)||0,a=h.children("ol"),r=t(window);h.css({width:a.outerWidth()+2*e,height:a.outerHeight()+2*i,"max-width":r.width()-2*o,"max-height":r.height()-2*n}),h.css({"margin-left":(r.width()-2*o-h.outerWidth())/2,"margin-top":(r.height()-2*n-h.outerHeight())/2})}function p(t){errorContainer.children("p").text(t).parent().fadeIn(250),g&&(v.scrollLeft(0),c.find(".tv-show-fs").prop("disabled",!0))}function u(){errorContainer.hide(),g&&c.find(".tv-show-fs").prop("disabled",!1)}var f,c,h,v,m,w,z,b,y,g,x,S,C,V;t.treeVisualizer=function(o,n){var a=t.extend({},t.treeVisualizer.defaults,n);a.normalView||a.fsView?(e(a),i(o)):console.error("Cannot initialize Tree Visualizer: either the container does not exist, or you have set both normal and fullscreen view to false, which does not make sense."),t(document).ready(function(){S||t(".tv-show-fs").click(function(t){b.css("top","-100%").children("ul").empty(),"undefined"!=typeof v&&v.find("a").removeClass("hovered"),r(),s(),f.fadeIn(250),l(),t.preventDefault()}),z.scroll(function(){d()}),t(window).scroll(function(){d()}),f.click(function(e){var i=t(e.target);i.closest(".tv-error, .tree, .tooltip, .zoom-opts").length||(f.fadeOut(250,function(){h.find("a").removeClass("hovered")}),S&&history.replaceState("",document.title,window.location.pathname+window.location.search))}),y.find("button").click(function(){var e=t(this);e.is(".close")?(f.fadeOut(250,function(){h.find("a").removeClass("hovered")}),S&&history.replaceState("",document.title,window.location.pathname+window.location.search)):(e.is(".zoom-in")?s("zoom-in"):e.is(".zoom-out")?s("zoom-out"):e.is(".zoom-default")&&s("zoom-default"),r(),l(),d())}),x&&t(window).on("resize",l),z.on("click","a",function(e){var i=t(this),o=i.parent("li"),n=o.data(),a=i.closest(".tree"),r=a.find("a"),s=a.next(".tooltip").children("ul");s.empty(),r.removeClass("hovered"),i.addClass("hovered");var l;for(l in n)n.hasOwnProperty(l)&&t("<li>",{html:"<strong>"+l+"</strong>: "+n[l]}).prependTo(s);d(),e.preventDefault()}),b.find("button").click(function(){var e=t(this),i=e.parent(".tooltip"),o=i.prev(".tree"),n=o.find("a");i.fadeOut(250),n.removeClass("hovered")})})},t.treeVisualizer.defaults={normalView:!0,nvFontSize:12,fsView:!0,fsFontSize:14,fsBtn:"",initFSOnClick:!1,container:"body"}}(jQuery);
