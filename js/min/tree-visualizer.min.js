!function(t){function e(e){errorContainer=t(".tv-error"),fontSizes=e.fsFontSizes,C=e.initFSOnClick;var o=[],i=[];if(e.normalView){g=!0,V=e.nvFontSize,t(e.container).append('<div id="tree-visualizer" style="display: none"></div>'),c=t("#tree-visualizer");var n='<div class="tv-error" style="display: none"><p></p></div><div class="tree" style="font-size: '+V+'px;"></div><aside class="tooltip" style="display: none"><ul></ul><button>&#10005;</button></aside>';e.fsView&&(n+='<button class="tv-show-fs">Fullscreen</button>'),c.append(n),v=c.find(".tree"),w=c.find(".tooltip"),o.push("#tree-visualizer .tree"),i.push("#tree-visualizer .tooltip")}if(e.fsView){x=!0,S=e.fsFontSize,t("body").append('<div id="tree-visualizer-fs" style="display: none"></div>'),f=t("#tree-visualizer-fs");var a='<div class="tv-error" style="display: none"><p></p></div><div class="tree" style="font-size: '+S+'px;"></div><aside class="tooltip" style="display: none"><ul></ul><button>&#10005;</button></aside><div class="zoom-opts"><button class="zoom-out">-</button><button class="zoom-default">Default</button><button class="zoom-in">+</button><button class="close">&#10005;</button></div>';f.hide().append(a),h=f.find(".tree"),m=f.find(".tooltip"),y=f.find(".zoom-opts"),o.push("#tree-visualizer-fs .tree"),i.push("#tree-visualizer-fs .tooltip")}advanced=e.advanced,""!=e.fsBtn&&t(e.fsBtn).addClass("tv-show-fs"),z=t(o.join()),b=t(i.join())}function o(e){t.ajax({type:"GET",url:e,dataType:"xml"}).done(function(t){null==t?p("Your XML appears to be empty or not in a compatible format."):(i(t),C&&(f.fadeIn(250),s(),r(),l()))}).fail(function(t){var e="";e=0===t.status?"Not connect.\n Verify Network.":404==t.status?"Requested page not found. [404]":500==t.status?"Internal Server Error [500].":"parsererror"===exception?"Requested parse failed.":"timeout"===exception?"Time out error.":"abort"===exception?"Ajax request aborted.":"Uncaught Error.\n"+t.responseText,p(e)})}function i(e){var o=t(e);u(),z.html(n(o.find("node").first())),b.children("ul").empty(),a()}function n(e){var o=t("<ol/>");return e.each(function(e,i){for(var a=t('<li><a href="#"></a></li>'),s=0,r=i.attributes.length,d=null;r>s;s++)d=i.attributes[s],a.attr("data-"+d.nodeName,d.value.replace(/^\s(.+)/g,"$1"));t(this).children("node").length&&a.append(n(t(this).children("node"))),o.append(a)}),o}function a(){z.find("a").each(function(){var e=t(this),o=e.parent("li");o.data("rel")&&(e.append("<span>"+o.data("rel")+"<span>"),o.data("index")&&e.append("<span>"+o.data("index")+"</span>")),o.data("pt")?o.data("index")?e.children("span:last-child").append(":"+o.data("pt")):e.append("<span>"+o.data("pt")+"</span>"):o.data("cat")&&(o.data("index")?e.children("span:last-child").append(":"+o.data("cat")):e.append("<span>"+o.data("cat")+"</span>")),e.is(":only-child")&&(o.data("lemma")&&o.append("<span>"+o.data("lemma")+"</span>"),o.data("word")&&o.append("<span><em>"+o.data("word")+"</em></span>")),e.addClass("only-child")}),z.find("li:only-child").addClass("only-child"),z.find("li:first-child").addClass("first-child"),z.find("li:last-child").addClass("last-child"),g&&c.show()}function s(){var t=parseInt(h.css("fontSize"),10);2>=t?y.find("button.zoom-out").prop("disabled",!0):t>=32?y.find("button.zoom-in").prop("disabled",!0):y.find("button").prop("disabled",!1)}function r(t){if("zoom-default"==t)h.css("fontSize",S+"px");else{var e=parseInt(h.css("fontSize"),10);"zoom-in"==t?h.css("fontSize",e+2+"px"):"zoom-out"==t&&h.css("fontSize",e-2+"px")}}function d(){var e;if("undefined"!=typeof h&&h.is(":visible")?e=h:"undefined"!=typeof v&&v.is(":visible")&&(e=v),"undefined"!=e){var o=e.find("a.hovered");if(o.length){var i=e.next(".tooltip"),n=o.offset(),a=e.offset(),s=t(window),r={top:n.top,right:s.outerWidth()-(n.left+o.outerWidth()),bottom:s.outerHeight()-(n.top+o.outerHeight()),left:n.left,w:o.outerWidth(),h:o.outerHeight()},d={top:a.top,right:s.outerWidth()-(a.left+e.outerWidth()),bottom:s.outerHeight()-(a.top+e.outerHeight()),left:a.left,w:e.outerWidth(),h:e.outerHeight()};i.css({left:parseInt(r.left+r.w/2-i.outerWidth()/2+7.5,10),top:parseInt(r.top-i.outerHeight()-24,10)-s.scrollTop()}),r.left+r.w/2<d.left||r.right+r.w/2<d.right||r.top+r.h/2<d.top||r.bottom+r.h<d.bottom?i.fadeOut(400):i.show()}}}function l(){var e=parseInt(h.css("paddingRight"),10)||0,o=parseInt(h.css("paddingTop"),10)||0,i=parseInt(f.css("paddingRight"),10)||0,n=parseInt(f.css("paddingTop"),10)||0,a=h.children("ol"),s=t(window);h.css({width:a.outerWidth()+2*e,height:a.outerHeight()+2*o,"max-width":s.width()-2*i,"max-height":s.height()-2*n}),h.css({"margin-left":(s.width()-2*i-h.outerWidth())/2,"margin-top":(s.height()-2*n-h.outerHeight())/2})}function p(t){errorContainer.children("p").text(t).parent().fadeIn(250),g&&(v.scrollLeft(0),c.find(".tv-show-fs").prop("disabled",!0))}function u(){errorContainer.hide(),g&&c.find(".tv-show-fs").prop("disabled",!1)}var f,c,h,v,m,w,z,b,y,g,x,C,S,V;t.treeVisualizer=function(i,n){var a=t.extend({},t.treeVisualizer.defaults,n);a.normalView||a.fsView?(e(a),o(i)):console.error("Cannot initialize Tree Visualizer: either the container does not exist, or you have set both normal and fullscreen view to false, which does not make sense."),t(document).ready(function(){C||t(".tv-show-fs").click(function(t){b.css("top","-100%").children("ul").empty(),"undefined"!=typeof v&&v.find("a").removeClass("hovered"),s(),r(),f.fadeIn(250),l(),t.preventDefault()}),z.scroll(function(){d()}),t(window).scroll(function(){d()}),f.click(function(e){var o=t(e.target);o.closest(".tv-error, .tree, .tooltip, .zoom-opts").length||(f.fadeOut(250,function(){h.find("a").removeClass("hovered")}),C&&history.replaceState("",document.title,window.location.pathname+window.location.search))}),y.find("button").click(function(){var e=t(this);e.is(".close")?(f.fadeOut(250,function(){h.find("a").removeClass("hovered")}),C&&history.replaceState("",document.title,window.location.pathname+window.location.search)):(e.is(".zoom-in")?r("zoom-in"):e.is(".zoom-out")?r("zoom-out"):e.is(".zoom-default")&&r("zoom-default"),s(),l(),d())}),x&&t(window).on("resize",l),z.on("click","a",function(e){var o=t(this),i=o.parent("li"),n=i.data(),a=o.closest(".tree"),s=a.find("a"),r=a.next(".tooltip").children("ul");r.empty(),s.removeClass("hovered"),o.addClass("hovered");var l;for(l in n)n.hasOwnProperty(l)&&t("<li>",{html:"<strong>"+l+"</strong>: "+n[l]}).prependTo(r);d(),e.preventDefault()}),b.find("button").click(function(){var e=t(this),o=e.parent(".tooltip"),i=o.prev(".tree"),n=i.find("a");o.fadeOut(250),n.removeClass("hovered")})})},t.treeVisualizer.defaults={normalView:!0,nvFontSize:12,fsView:!0,fsFontSize:14,fsBtn:"",initFSOnClick:!1,container:"body"}}(jQuery);
